# Test that radosgw-admin bucket logging flush works with tenanted buckets as target
# script: test_server_access_logging.py
# bz: https://bugzilla.redhat.com/show_bug.cgi?id=2360666
config:
  user_count: 1
  bucket_count: 1
  objects_count: 5
  objects_size_range:
    min: 5
    max: 15
  user_type: tenanted
  test_ops:
    create_bucket: true
    create_object: true
    upload_type: normal
    put_get_bucket_logging: true
    test_tenanted_bucket_logging_flush: true
    logging_type: Journal
    target_obj_key_format: SimplePrefix
    rgw_admin_flush: true
    policy_document:
      {
        "Version": "2012-10-17",
        "Statement": [
         {
          "Sid": "AllowLoggingFromSourceBucketPolicy1",
          "Effect": "Allow",
          "Principal": {
           "Service": "logging.s3.amazonaws.com"
          },
          "Action": "s3:PutObject",
          "Resource": "arn:aws:s3:::<dest_bucket_name>/*",
          "Condition": {
           "StringEquals": {
            "aws:SourceAccount": "<source_user_name>"
           },
           "ArnLike": {
            "aws:SourceArn": "arn:aws:s3:::<source_bucket_name>"
           }
          }
         }
        ]
      }
